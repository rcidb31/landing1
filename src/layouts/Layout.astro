---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Chatbot from '../components/chatbot.astro';

import '../styles/animations.css';
import '../styles/chatbot.css';

interface Props {
    title: string;
}

const { title } = Astro.props;
---

<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Portafolio de Raul Cid" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/log.ico" />

    <!-- Preload imagen de fondo -->
    <link rel="preload" href="/back.webp" as="image" type="image/webp" />

    <!-- Preconnect para Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="/src/styles/animations.css" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
</head>
  <body>
    <div>
      <Header />
        <main class="flex-grow container mx-auto px-4 sm:px-6 md:px-8">
         <slot />
       </main>
      <Footer />
    </div>
     <Chatbot/>

     <!-- Botón volver arriba -->
     <button class="back-to-top" id="backToTop" aria-label="Volver arriba">
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
         <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
       </svg>
     </button>

     <script src="/src/js/main.js"></script>
     <script src="/src/js/certification.js"></script>
     <script src="/src/js/chatbot.js"></script>

     <script>
       // Botón volver arriba
       const backToTop = document.getElementById('backToTop');
       window.addEventListener('scroll', () => {
         if (window.scrollY > 400) {
           backToTop.classList.add('visible');
         } else {
           backToTop.classList.remove('visible');
         }
       });
       backToTop.addEventListener('click', () => {
         window.scrollTo({ top: 0, behavior: 'smooth' });
       });

       // Indicador de sección activa en navegación
       const sections = document.querySelectorAll('section[id]');
       const navLinks = document.querySelectorAll('nav a[href^="#"]');

       const observerOptions = {
         root: null,
         rootMargin: '-20% 0px -70% 0px',
         threshold: 0
       };

       const observer = new IntersectionObserver((entries) => {
         entries.forEach(entry => {
           if (entry.isIntersecting) {
             navLinks.forEach(link => {
               link.classList.remove('active');
               if (link.getAttribute('href') === '#' + entry.target.id) {
                 link.classList.add('active');
               }
             });
           }
         });
       }, observerOptions);

       sections.forEach(section => observer.observe(section));
     </script>
 </body>
</html>

<style is:global>
    :root {
        color-scheme: light dark;
    }
    /* Estilo general */
    html {
        font-family: 'Press Start 2P', monospace;
        scroll-behavior: smooth;
    }
    body {
       background: url('/back.webp') no-repeat center top;
       background-size: cover;
       background-color: #1522;
       background-attachment: fixed;
    }
    #page {
         filter: brightness(1.1);
    }
    body::before {
       content: "";
       position: fixed;
       top: 0; left: 0; width: 100%; height: 100%;
       background: linear-gradient(
         125deg,
         rgba(14, 165, 233, 0.08) 0%,
         rgba(139, 92, 246, 0.08) 25%,
         rgba(14, 165, 233, 0.05) 50%,
         rgba(139, 92, 246, 0.08) 75%,
         rgba(14, 165, 233, 0.08) 100%
       );
       background-size: 400% 400%;
       animation: gradient-flow 18s ease infinite;
       z-index: -1;
    }

    @keyframes gradient-flow {
       0% { background-position: 0% 50%; }
       50% { background-position: 100% 50%; }
       100% { background-position: 0% 50%; }
    }
    html, body {
        overflow-x: hidden;
        max-width: 100vw;
    }
    body.modal-open {
      overflow: hidden;
      position: fixed;
      width: 100%;
    }

    /* Scroll margin para navegación con header fijo */
    section[id] {
        scroll-margin-top: 80px;
    }

    /* Mejora de touch targets en móvil */
    @media (max-width: 640px) {
        a, button {
            min-height: 44px;
            min-width: 44px;
        }
    }

    /* Botón volver arriba */
    .back-to-top {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 44px;
        height: 44px;
        background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
    }
    .back-to-top.visible {
        opacity: 1;
        visibility: visible;
    }
    .back-to-top:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.6);
    }
    .back-to-top svg {
        width: 24px;
        height: 24px;
        color: white;
    }

    /* Indicador de navegación activa */
    nav a.active {
        color: #0ea5e9 !important;
        position: relative;
    }
    nav a.active::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #0ea5e9, #8b5cf6);
        border-radius: 2px;
    }

    .chatbot-container {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        z-index: 999999 !important;
        pointer-events: auto !important;
    }
    .chatbot-window {
        z-index: 999998 !important;
    }
</style>
 