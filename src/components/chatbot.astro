---
// Chatbot.astro
export interface Props {
  title?: string;
  welcomeMessage?: string;
  theme?: 'light' ;
}

const {
  title = "Asistente cidev.dev",
  welcomeMessage = "Â¡Hola! ðŸ‘‹ Soy el asistente de cidev.dev. Puedo ayudarte con informaciÃ³n sobre proyectos, experiencia tÃ©cnica y servicios. Â¿En quÃ© puedo asistirte?",
  theme = 'light'
} = Astro.props;
---

<div class="chatbot-container">
  <!-- BotÃ³n flotante -->
  <button
    class="chatbot-button"
    onclick="toggleChatbot()"
    aria-label="Abrir chatbot"
    title="Â¿Necesitas ayuda? Â¡PregÃºntame!"
  >ðŸ’¬</button>

  <!-- Ventana del chatbot -->
  <div
    class="chatbot-window"
    id="chatbotWindow"
    role="dialog"
    aria-labelledby="chatbot-title"
    data-theme={theme}
  >
    <div class="chatbot-header">
      <!-- BotÃ³n cerrar para mÃ³viles -->
      <button 
        class="chatbot-close" 
        onclick="toggleChatbot()"
        aria-label="Cerrar chatbot"
        title="Cerrar"
      >âœ•</button>
      
      <h3 id="chatbot-title">{title}</h3>
      <div class="status">ðŸŸ¢ En lÃ­nea</div>
    </div>

    <div class="chatbot-messages" id="chatbotMessages" role="log" aria-live="polite">
      <div class="message bot">
        <div class="message-bubble">{welcomeMessage}</div>
      </div>
    </div>

    <div class="quick-actions" role="group" aria-label="Acciones rÃ¡pidas">
      <button class="quick-action-btn" onclick="sendQuickMessage('Ver proyectos')">ðŸš€ Ver proyectos</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('Experiencia tÃ©cnica')">ðŸ’» Experiencia</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('Contacto')">ðŸ“§ Contacto</button>
    </div>

    <div class="typing-indicator" id="typingIndicator" style="display:none">
      Escribiendo<span class="typing-dots">...</span>
    </div>

    <div class="chatbot-input">
      <label for="chatbotInput" class="sr-only">Escribe tu mensaje</label>
      <input 
        id="chatbotInput" 
        type="text" 
        placeholder="Escribe tu mensajeâ€¦" 
        onkeydown="handleKeyPress(event)" 
        autocomplete="off" 
        maxlength="500" 
      />
      <button class="send-btn" onclick="sendMessage()" aria-label="Enviar">âž¤</button>
    </div>
  </div>

  <!-- Overlay para cerrar tocando fuera en mÃ³viles -->
  <div id="chatbotOverlay" class="chatbot-overlay" aria-hidden="true"></div>
</div>

<style>
  /* Estilos de accesibilidad */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  
