---
// Chatbot.astro
export interface Props {
  title?: string;
  welcomeMessage?: string;
  theme?: 'light' ;
}

const {
  title = "Agente IA de RaÃºl",
  welcomeMessage = "Â¡Hola! Soy el agente IA de RaÃºl Cid. Puedo contarte sobre sus proyectos, experiencia, certificaciones y mÃ¡s. Â¿En quÃ© te puedo ayudar?",
  theme = 'light'
} = Astro.props;
---

<div class="chatbot-container">
  <!-- BotÃ³n flotante -->
  <button
    class="chatbot-button pulse"
    id="chatbotToggle"
    aria-label="Abrir chatbot"
    title="Â¿Necesitas ayuda? Â¡PregÃºntame!"
  >
    <svg class="icon-chat" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <svg class="icon-close" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <!-- Template para lazy load -->
  <template id="chatbotTemplate">
    <div
      class="chatbot-window"
      id="chatbotWindow"
      role="dialog"
      aria-labelledby="chatbot-title"
      data-theme={theme}
    >
      <div class="chatbot-header">
        <button
          class="chatbot-close"
          id="chatbotClose"
          aria-label="Cerrar chatbot"
          title="Cerrar"
        >âœ•</button>

        <h3 id="chatbot-title">{title}</h3>
        <div class="status">ðŸŸ¢ En lÃ­nea</div>
      </div>

      <div class="chatbot-messages" id="chatbotMessages" role="log" aria-live="polite">
        <div class="message bot">
          <div class="message-bubble">{welcomeMessage}</div>
        </div>
      </div>

      <div class="quick-actions" role="group" aria-label="Acciones rÃ¡pidas">
        <button class="quick-action-btn" data-quick-msg="Â¿CuÃ¡les son los proyectos de RaÃºl?">Proyectos</button>
        <button class="quick-action-btn" data-quick-msg="Â¿CuÃ¡l es la experiencia laboral de RaÃºl?">Experiencia</button>
        <button class="quick-action-btn" data-quick-msg="Â¿CÃ³mo puedo contactar a RaÃºl?">Contacto</button>
      </div>

      <div class="typing-indicator" id="typingIndicator" style="display:none">
        <span class="typing-dot"></span>
        <span class="typing-dot"></span>
        <span class="typing-dot"></span>
      </div>

      <div class="chatbot-input">
        <label for="chatbotInput" class="sr-only">Escribe tu mensaje</label>
        <input
          id="chatbotInput"
          type="text"
          placeholder="Escribe tu mensajeâ€¦"
          autocomplete="off"
          maxlength="500"
        />
        <button class="send-btn" id="chatbotSend" aria-label="Enviar">âž¤</button>
      </div>
      <div class="chatbot-powered">Powered by Gemini</div>
    </div>

    <div id="chatbotOverlay" class="chatbot-overlay" aria-hidden="true"></div>
  </template>
</div>

<style>
  /* Estilos de accesibilidad */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }


</style>
